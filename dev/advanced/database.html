<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Database | Intersect Documentation</title>
    <meta name="description" content="The free, open-source, modern 2d mmorpg maker.">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#0e4688">
  <link rel="manifest" href="/favicons/manifest.json">
  <link rel="shortcut icon" href="/favicons/favicon.ico">
  <meta name="msapplication-config" content="/favicons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.c39eb8bf.css" as="style"><link rel="preload" href="/assets/js/app.ff54c2a5.js" as="script"><link rel="preload" href="/assets/js/44.0702888f.js" as="script"><link rel="prefetch" href="/assets/js/10.e6faf1f1.js"><link rel="prefetch" href="/assets/js/11.6147fbaa.js"><link rel="prefetch" href="/assets/js/12.a92eedfb.js"><link rel="prefetch" href="/assets/js/13.4f1c1e76.js"><link rel="prefetch" href="/assets/js/14.5ff9a9c4.js"><link rel="prefetch" href="/assets/js/15.4989fcef.js"><link rel="prefetch" href="/assets/js/16.60fbd61f.js"><link rel="prefetch" href="/assets/js/17.ec7fb34c.js"><link rel="prefetch" href="/assets/js/18.a846c8c0.js"><link rel="prefetch" href="/assets/js/19.d9add171.js"><link rel="prefetch" href="/assets/js/2.88cb7eb7.js"><link rel="prefetch" href="/assets/js/20.7f8f503c.js"><link rel="prefetch" href="/assets/js/21.f89ecd6a.js"><link rel="prefetch" href="/assets/js/22.baa49f2e.js"><link rel="prefetch" href="/assets/js/23.b88a8364.js"><link rel="prefetch" href="/assets/js/24.1ecf74b9.js"><link rel="prefetch" href="/assets/js/25.d7a4af9c.js"><link rel="prefetch" href="/assets/js/26.6851375c.js"><link rel="prefetch" href="/assets/js/27.e7b820f9.js"><link rel="prefetch" href="/assets/js/28.52453d67.js"><link rel="prefetch" href="/assets/js/29.41ef250f.js"><link rel="prefetch" href="/assets/js/3.4de7dee9.js"><link rel="prefetch" href="/assets/js/30.b3d250e6.js"><link rel="prefetch" href="/assets/js/31.ee50caac.js"><link rel="prefetch" href="/assets/js/32.0c3f646a.js"><link rel="prefetch" href="/assets/js/33.fc35ce28.js"><link rel="prefetch" href="/assets/js/34.4956d0a0.js"><link rel="prefetch" href="/assets/js/35.22df3e87.js"><link rel="prefetch" href="/assets/js/36.9ad5c2f2.js"><link rel="prefetch" href="/assets/js/37.a1e417b4.js"><link rel="prefetch" href="/assets/js/38.dc1419ef.js"><link rel="prefetch" href="/assets/js/39.d2f41128.js"><link rel="prefetch" href="/assets/js/4.e0fb72f5.js"><link rel="prefetch" href="/assets/js/40.09738174.js"><link rel="prefetch" href="/assets/js/41.b5ecbc17.js"><link rel="prefetch" href="/assets/js/42.080c8c60.js"><link rel="prefetch" href="/assets/js/43.1cf02d41.js"><link rel="prefetch" href="/assets/js/45.e7922503.js"><link rel="prefetch" href="/assets/js/46.a71d071c.js"><link rel="prefetch" href="/assets/js/47.e1bbc03f.js"><link rel="prefetch" href="/assets/js/48.6f52f1bc.js"><link rel="prefetch" href="/assets/js/49.b244d87a.js"><link rel="prefetch" href="/assets/js/5.16fb52e2.js"><link rel="prefetch" href="/assets/js/50.492781b9.js"><link rel="prefetch" href="/assets/js/51.c8815964.js"><link rel="prefetch" href="/assets/js/52.ead2ec45.js"><link rel="prefetch" href="/assets/js/53.73443f3d.js"><link rel="prefetch" href="/assets/js/54.a73728fe.js"><link rel="prefetch" href="/assets/js/55.1b060164.js"><link rel="prefetch" href="/assets/js/56.43e5b481.js"><link rel="prefetch" href="/assets/js/57.0dcb5b67.js"><link rel="prefetch" href="/assets/js/58.9592cbd7.js"><link rel="prefetch" href="/assets/js/59.9e9d36a7.js"><link rel="prefetch" href="/assets/js/6.c4cbf670.js"><link rel="prefetch" href="/assets/js/60.f10b918a.js"><link rel="prefetch" href="/assets/js/61.044cf048.js"><link rel="prefetch" href="/assets/js/62.648e2bc7.js"><link rel="prefetch" href="/assets/js/63.d5e1da34.js"><link rel="prefetch" href="/assets/js/64.c540c327.js"><link rel="prefetch" href="/assets/js/65.9c9d3127.js"><link rel="prefetch" href="/assets/js/66.e19f4cc5.js"><link rel="prefetch" href="/assets/js/67.c01702c3.js"><link rel="prefetch" href="/assets/js/68.b49c29bd.js"><link rel="prefetch" href="/assets/js/69.5e142496.js"><link rel="prefetch" href="/assets/js/7.3dbf7140.js"><link rel="prefetch" href="/assets/js/70.fa6be236.js"><link rel="prefetch" href="/assets/js/8.1ce26dcc.js"><link rel="prefetch" href="/assets/js/9.222b1d55.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c39eb8bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://www.ascensiongamedev.com/resources/filehost/e37ded2fa492ae07375cd18bd1d8312c.png" alt="Intersect Documentation" class="logo"> <span class="site-name can-hide">Intersect Documentation</span></a> <div class="links" style="max-width:nullpx;"><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">User Docs</a></div><div class="nav-item"><a href="/api/v1/" class="nav-link">API Reference</a></div><div class="nav-item"><a href="/dev/" class="router-link-active nav-link">Developer Guides</a></div><div class="nav-item"><a href="https://www.ascensiongamedev.com/forum/53-questions-and-answers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support Community
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" placeholder="Search" value=""> <!----></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">User Docs</a></div><div class="nav-item"><a href="/api/v1/" class="nav-link">API Reference</a></div><div class="nav-item"><a href="/dev/" class="router-link-active nav-link">Developer Guides</a></div><div class="nav-item"><a href="https://www.ascensiongamedev.com/forum/53-questions-and-answers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support Community
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Developer Information</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Making Changes</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Staying up to Date</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Sharing &amp; Contributions</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Advanced</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/dev/advanced/database.html" class="active sidebar-link">Database</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/advanced/database.html#database-fields" class="sidebar-link">Database Fields</a></li><li class="sidebar-sub-header"><a href="/dev/advanced/database.html#adding-fields" class="sidebar-link">Adding Fields</a></li><li class="sidebar-sub-header"><a href="/dev/advanced/database.html#creating-a-migration" class="sidebar-link">Creating a Migration</a></li><li class="sidebar-sub-header"><a href="/dev/advanced/database.html#migration-limitations" class="sidebar-link">Migration Limitations</a></li><li class="sidebar-sub-header"><a href="/dev/advanced/database.html#migrations-are-one-way" class="sidebar-link">Migrations are one-way</a></li></ul></li><li><a href="/dev/advanced/packets.html" class="sidebar-link">Creating New Packets</a></li><li><a href="/dev/advanced/eventcommands.html" class="sidebar-link">Adding Event Commands</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="database"><a href="#database" class="header-anchor">#</a> Database</h1> <p>Intersect has two databases, one that stores game data such as items, maps, resources, events, etc and another that stores all data related to player accounts.</p> <p>The tables in both databases are automatically generated based on contexts. The player context and game context are defined in the following source files:</p> <ul><li>Intersect.Server/Database/GameData/GameContext.cs</li> <li>Intersect.Server/Database/PlayerData/PlayerContext.cs</li></ul> <p>Contexts consist DBSets which end up being tables. DBSets are created from C# Classes.</p> <p>The context classes also define relationships between the tables. You can learn more about that from the Entity Framework Core documentation if interested.</p> <h2 id="database-fields"><a href="#database-fields" class="header-anchor">#</a> Database Fields</h2> <p>Fields are automatically created from public properties in a class much like Tables are automatically created from Classes within DBSets in a context.</p> <p>If you look at the Users class in the server (Interect.Server/Database/PlayerData/User.cs) you will see fields for the user's id, name, password, salt, email, and more.</p> <p>Please note, Entity Framework can only handle basic types (integers, strings, blobs, and references to other classes that exist as a DBSet). Due to these limitations we mark some complex fields as <code>[NotMapped]</code> and then have a secondary string field that converts the complex field to json. For an example of this see User.Power and User.PowerJson. Notice how the PowerJson property has a column name property so it is stored in the database in the Power field.</p> <h2 id="adding-fields"><a href="#adding-fields" class="header-anchor">#</a> Adding Fields</h2> <p>In order to add a field to the database create a new public property in a class that is stored within Entity Framework. In this example I am going to add a field for each User that tracks their last used ip address.</p> <p>I added the following property to the User class:</p> <div class="language- extra-class"><pre class="language-text"><code>public string LastUsedIp { get; set; }
</code></pre></div><h2 id="creating-a-migration"><a href="#creating-a-migration" class="header-anchor">#</a> Creating a Migration</h2> <p>After making changes to Entity Framework classes you will need to create a migration. In order to create the migration there are several setup steps:</p> <ul><li><a href="https://www.ascensiongamedev.com/resources/filehost/13a8de43d24b7595cacb37c5c99c65f1.png" target="_blank" rel="noopener noreferrer">Set your startup project to Intersect Server, and the build type to NoFody<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.ascensiongamedev.com/resources/filehost/73271e21395e697efb06cf7d28f0f14d.png" target="_blank" rel="noopener noreferrer">Now build your server. Building with the NoFody configuration will generate a bunch of required dlls.<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.ascensiongamedev.com/resources/filehost/c51298fbaf5e35a654b43c915ab5375f.png" target="_blank" rel="noopener noreferrer">In VS open a Nuget Package Manager Console. (Tools -&gt; Nuget Package Manager -&gt; Package Manager Console)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.ascensiongamedev.com/resources/filehost/2eea276e85b6258c5b844f392acdfd15.png" target="_blank" rel="noopener noreferrer">Within the package manager console set your default project to Intersect.Server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Now you're ready to generate the migration files. Enter the following command into the package manager console:</p> <div class="language- extra-class"><pre class="language-text"><code>Add-Migration -Context [ContextHere] [InsertMigrationNameHere]
</code></pre></div><p>Replace <code>[ContextHere]</code> with either GameContext or PlayerContext depending on which database you modified.</p> <p>Replace <code>[InsertMigrationNameHere]</code> with a short identifier of what the migration is for.</p> <p>For example I added a LastUsedId property to the Users class. In this case I would use the following command:</p> <div class="language- extra-class"><pre class="language-text"><code>Add-Migration -Context PlayerContext AddingLastUsedIpToUsers
</code></pre></div><p>Your migration should appear as a new <a href="https://www.ascensiongamedev.com/resources/filehost/500983d59ef1b372947c3c2e9ff5aa47.png" target="_blank" rel="noopener noreferrer">source code file<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Go ahead and save it.</p> <p>Now that we're done change the solution configuration from NoFody back to Debug and run your server.</p> <p>You will be greeted with the <a href="https://www.ascensiongamedev.com/resources/filehost/a0eca1c08ed9ad5b5324ef4502cded49.png" target="_blank" rel="noopener noreferrer">migration prompt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="migration-limitations"><a href="#migration-limitations" class="header-anchor">#</a> Migration Limitations</h2> <p>Due to (current) limitations in Sqlite fields cannot be renamed or removed. We have a few fields that we keep around that are not in use due to these limitations. It is expected that this functionality will someday be available.</p> <h2 id="migrations-are-one-way"><a href="#migrations-are-one-way" class="header-anchor">#</a> Migrations are one-way</h2> <p>Unfortunately migrations are one-way due to limitations above with Sqlite. If users want to uninstall source modifications that alter the database they will have to use external tools to remove the database fields or revert to a backup before the modification was installed.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/AscensionGameDev/Intersect-Documentation/edit/master/dev/advanced/database.md" target="_blank" rel="noopener noreferrer">Help us improve this page.</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/dev/sharing/contributing.html" class="prev">
          Contributing to the Official Repo
        </a></span> <span class="next"><a href="/dev/advanced/packets.html">
          Creating New Packets
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.ff54c2a5.js" defer></script><script src="/assets/js/44.0702888f.js" defer></script>
  </body>
</html>
